There is some shellcode, which getting pointer to following struct as an argument:
```
struct shellcode_arg {
    void* lla_ptr;
    void* get_proc_addr_ptr;
    char* flag_ptr;
    uint32_t flag_size;
};
```

Let's see the shellcode.. i reversed it a bit
```
  GetModuleFileNameA(0, &v6, 260);
  file = fopen(&v6, a_rb);
  fseek(file, 0x4E, 0);                         // jumps to "This program bla bla" text from PE header
  fread(key, 38, 1, file);                      // reads 38 bytes string (This program cannot be run in DOS mode)
  result = fclose(file);
  index = 0;
  do
  {
    *(encrypted_string + index++) ^= key[index];
  }
  while ( index != encrypted_string_size );
```

So, shellcode opens self executable, reading string from pe headers and using it as a key for xor. Full func from ida available at shellcode.c.

Soulution availbable at main.cpp
